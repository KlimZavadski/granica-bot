# Troubleshooting Guide

## –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è

### –°–∏–º–ø—Ç–æ–º—ã:
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- Callback –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ UI –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "—á–∞—Å–∏–∫–∏" –∑–∞–≥—Ä—É–∑–∫–∏

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞

–ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞ –∏ —Å–º–æ—Ç—Ä–∏ –≤ –∫–æ–Ω—Å–æ–ª—å:

```bash
python3 bot.py
```

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –¥–∞—Ç—É –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üìÖ Calendar callback: cal_day_2024_11_29
Current state: JourneyStates:entering_departure_date
Action: day
```

–ï—Å–ª–∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è - callback –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –±–æ—Ç–∞.

#### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
pkill -f bot.py

# –ó–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ
python3 bot.py
```

#### 3. –û—á–∏—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–í –±–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É:
```
/cancel
/new
```

#### 4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–æ—Ç

- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–æ–∫–µ–Ω –≤ `.env` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Å—å —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π –±–æ—Ç–∞:
  ```bash
  ps aux | grep bot.py
  ```

#### 5. –í–∫–ª—é—á–∏ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í `bot.py` –∏–∑–º–µ–Ω–∏:

```python
logging.basicConfig(
    level=logging.DEBUG,  # –ë—ã–ª–æ: INFO
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

#### 6. –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM

–î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:

```python
data = await state.get_data()
print(f"State data: {data}")
```

---

## Keyboard –Ω–µ –ø—Ä—è—á–µ—Ç—Å—è

### –†–µ—à–µ–Ω–∏–µ:

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```python
await message.answer(
    "–í—ã–±—Ä–∞–Ω –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫",
    reply_markup=ReplyKeyboardRemove()
)
```

---

## –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤–æ–æ–±—â–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
```bash
ps aux | grep bot.py
```

### 2. –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω
```bash
# –í .env –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
cat .env | grep TELEGRAM_BOT_TOKEN
```

### 3. –ü—Ä–æ–≤–µ—Ä—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Telegram API
```bash
curl https://api.telegram.org/botYOUR_TOKEN/getMe
```

---

## Database errors

### "Table doesn't exist"
–ó–∞–ø—É—Å—Ç–∏ —Å—Ö–µ–º—É:
```bash
# –°–∫–æ–ø–∏—Ä—É–π database/schema.sql
# –í—Å—Ç–∞–≤—å –≤ Supabase SQL Editor
```

### "Connection refused"
–ü—Ä–æ–≤–µ—Ä—å:
- SUPABASE_URL –≤ `.env`
- SUPABASE_KEY –≤ `.env`
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

---

## Callback query is too old

–≠—Ç–æ–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ü—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ –Ω–æ–≤—É—é –ø–æ–µ–∑–¥–∫—É:
```
/new
```

---

## –ù–µ—Å–∫–æ–ª—å–∫–æ –±–æ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ

–û—Å—Ç–∞–Ω–æ–≤–∏ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:
```bash
pkill -f bot.py
```

–ó–∞–ø—É—Å—Ç–∏ –æ–¥–∏–Ω:
```bash
python3 bot.py
```

---

## Debugging Tips

### 1. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
```bash
tail -f bot.log
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π print –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```python
print(f"Debug: {variable}")
```

### 3. –ü—Ä–æ–≤–µ—Ä—è–π state
```python
current_state = await state.get_state()
print(f"State: {current_state}")
```

### 4. –¢–µ—Å—Ç–∏—Ä—É–π –ø–æ —à–∞–≥–∞–º
- /start - —Ä–∞–±–æ—Ç–∞–µ—Ç?
- /new - —Ä–∞–±–æ—Ç–∞–µ—Ç?
- –í—ã–±–æ—Ä –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ - —Ä–∞–±–æ—Ç–∞–µ—Ç?
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å - —Ä–∞–±–æ—Ç–∞–µ—Ç?

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### "unhashable type: 'list'"
FSM state data —Å–æ–¥–µ—Ä–∂–∏—Ç list. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–µ —Ç–∏–ø—ã.

### "Message is not modified"
–ü—ã—Ç–∞–µ—à—å—Å—è edit_text –Ω–∞ —Ç–æ –∂–µ —Å–∞–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ò–≥–Ω–æ—Ä–∏—Ä—É–π –∏–ª–∏ –∏–∑–º–µ–Ω–∏ —Ç–µ–∫—Å—Ç.

### "Query is too old"
–°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ. –ù–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ —Å /new.

---

## –ü–æ–ª—É—á–∏ –ø–æ–º–æ—â—å

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞
2. –ü–æ–ø—Ä–æ–±—É–π /cancel –∏ /new
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä—å .env —Ñ–∞–π–ª
5. –û—Ç–∫—Ä–æ–π issue –Ω–∞ GitHub —Å –ª–æ–≥–∞–º–∏

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep bot.py

# –£–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
pkill -f bot.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
lsof -i :8080

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f bot.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –ø–∞–∫–µ—Ç—ã
pip list

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt --force-reinstall
```

